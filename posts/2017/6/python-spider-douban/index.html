<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="yokonsan" />
	
	
	
	<title>Python爬虫(5):豆瓣读书练手爬虫 ｜ 乾之 三爻</title>
	
    
    
    <meta name="description" content="我们在之前的文章中基本上掌握了Python爬虫的原理和方法，不知道大家有没有练习呢。今天我就来找一个简单的网页进行爬取，就当是给之前的兵书做一个实践。不然不就是纸上谈兵的赵括了吗。 好了，我们这次的目标" />
    

    
    
    <meta name="keywords" content="技术, 生活, 分享" />
    

	
    
    <link rel="shortcut icon" href="https://yokonsan.github.io/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://yokonsan.github.io/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://yokonsan.github.io/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://yokonsan.github.io/css/highlight.css" />

    
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://yokonsan.github.io/">
                    <span>乾之 三爻</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">yokon&#39;s blog</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/yokonsan" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                <a href="https://yokonsan.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2017/6/python-spider-douban/'>Python爬虫(5):豆瓣读书练手爬虫</a></h2>
                        <span class="date">2017.06.03</span>
                    </div>
                    <div class="post_content markdown"><p>我们在之前的文章中基本上掌握了<code>Python</code>爬虫的原理和方法，不知道大家有没有练习呢。今天我就来找一个简单的网页进行爬取，就当是给之前的兵书做一个实践。不然不就是纸上谈兵的赵括了吗。</p>
<p>好了，我们这次的目标是<code>豆瓣图书Top250</code>，地址是：<code>https://book.douban.com/top250?start=0</code></p>
<h2 id="准备">准备</h2>
<p>爬一个网页我们至少要知道自己需要什么信息，大家看截图：</p>
<p><img src="/image/post7/post7_1.jpg" alt="post7_1.jpg"></p>
<p>红色箭头标记的地方就是我们要获取的信息了，包括书的名字，作者和出版社信息，豆瓣评分和一句话简介。我们有了目标信息，就需要找到信息所在的页面源码，然后通过解析源码来获取到信息数据。那么，我们怎样获得页面 HTML 源代码呢？翻阅兵书，我们知道可以使用<code>requests</code>之计。代码实现如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://book.douban.com/top250?start=0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>运行程序，我们就轻松的获得了敌军的 HTML 信息了。但是问题又来了，我们得到 HTML 信息后，怎样得到我们的目标数据呢？</p>
<p><strong>深夜了，一轮弯月躲在云朵后面，窗外下着雨，我们坐在烛火前，翻阅兵书，顿时茅塞顿开，BeautifulSoup大法好。</strong></p>
<p>我们打开浏览器，按<code>f12</code>到开发者工具，我们从网页源码里查找到数据位置，截图如下：</p>
<p><img src="/image/post7/post7_2.jpg" alt="post7_2.jpg"></p>
<p>可以看到书名信息包含在<code>class='pl2'</code> <code>div</code>里面的<code>a</code>标签内，是<code>a</code>标签的<code>title</code>属性。发现目标位置后，就简单多了。我们利用<code>BeautifulSoup</code>来获得一个对象，按找标准的缩进显示的<code>html</code>代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>推荐大家使用lxml解析器，因为他快。如果安装lxml遇到问题的可以参考 <a href="https://www.yukunweb.com/2017/6/python-spider-BeautifulSoup-basic/">上一篇文章</a> 的方法。当然，如果大家怕麻烦，也完全可以使用Python的内置标准库<code>html.parser</code>.对我们获得结果并没有影响。</p>
<h2 id="开始工作">开始工作</h2>
<p>现在我们要用到<code>BeautifulSoup</code>的<code>find_all()</code>选择器，因为我们这一页有很多书，而每一本书的信息都包含在<code>class=pl2</code>的<code>div</code>标签内，我们使用<code>find_all()</code>就可以直接得到本页所有书的书名了。我们用<code>find()</code>方法和<code>find_all()</code>方法来做一个比较：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># find_all()方法，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注意class是Python关键词，后面要加下划线_：</span>
</span></span><span class="line"><span class="cl"><span class="n">alldiv</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alldiv</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">names</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;find_all():&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># find()方法：</span>
</span></span><span class="line"><span class="cl"><span class="n">alldiv2</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">names2</span> <span class="o">=</span> <span class="n">alldiv2</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;find():&#39;</span><span class="p">,</span> <span class="n">names2</span> <span class="p">)</span>
</span></span></code></pre></div><p>运行结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">find_all(): 追风筝的人
</span></span><span class="line"><span class="cl">find_all(): 小王子
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl"># ...省略部分
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl">find_all(): 三体Ⅲ
</span></span><span class="line"><span class="cl">find(): 追风筝的人
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Process finished with exit code 0
</span></span></code></pre></div><p>我们通过结果就可以看到两者之间的差距了，前者输出了一页的数据，而后者只输出了第一条数据。所以包括后面的信息，由于每一天数据所在标签是一样的，我们都是用<code>find_all()</code>方法。</p>
<p>上面的代码写的优雅点，就是这样实现,注意结果是一个 list：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 书名, 注意是L小写，不是阿拉伯数字1</span>
</span></span><span class="line"><span class="cl"><span class="n">alldiv</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alldiv</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</span></span></code></pre></div><p>这样书名数据我们就得到了，接下来是作者信息。方法和获取书名方法一样：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 作者,由于信息在一个p标签内部，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 我们获取到标签直接get_text()方法获得文本内容</span>
</span></span><span class="line"><span class="cl"><span class="n">allp</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allp</span><span class="p">]</span>
</span></span></code></pre></div><p>运行结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[&#39;[美] 卡勒德·胡赛尼 / 李继宏 / 上海人民出版社 / 2006-5 / 29.00元&#39;, 
</span></span><span class="line"><span class="cl">&#39;[法] 圣埃克苏佩里 / 马振聘 / 人民文学出版社 / 2003-8 / 22.00元&#39;, 
</span></span><span class="line"><span class="cl">&#39;钱锺书 / 人民文学出版社 / 1991-2 / 19.00&#39;, 
</span></span><span class="line"><span class="cl">&#39;余华 / 南海出版公司 / 1998-5 / 12.00元&#39;, 
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl"># ...省略部分结果
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl">&#39;高铭 / 武汉大学出版社 / 2010-2 / 29.80元&#39;, 
</span></span><span class="line"><span class="cl">&#39;刘慈欣 / 重庆出版社 / 2010-11 / 38.00元&#39;]
</span></span></code></pre></div><p>后面的评分内容和简介内容也是一样获得，只是标签不同，但是方法一样，具体也不需要多余赘述。直接看实现代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 评分</span>
</span></span><span class="line"><span class="cl"><span class="n">starspan</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;rating_nums&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">starspan</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 简介</span>
</span></span><span class="line"><span class="cl"><span class="n">sumspan</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;inq&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sums</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sumspan</span><span class="p">]</span>
</span></span></code></pre></div><p>程序运行成功，我们就获得了4个list，分别是书名，作者，评分和简介内容。我们要把他们放在一起，打印出来，就是一页的数据信息了。
这里我们使用<code>zip()</code>函数，<code>zip()</code>函数在运算时，会以一个或多个序列做为参数，返回一个元组的列表。同时将这些序列中并排的元素配对。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="nb">sum</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">authors</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">sums</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;书名：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">author</span> <span class="o">=</span> <span class="s1">&#39;作者：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">score</span> <span class="o">=</span> <span class="s1">&#39;评分：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="nb">sum</span> <span class="o">=</span> <span class="s1">&#39;简介：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">data</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">author</span> <span class="o">+</span> <span class="n">score</span> <span class="o">+</span> <span class="nb">sum</span>
</span></span></code></pre></div><p>我们使用换行符&rsquo;<code>\n</code>&lsquo;给数据信息一点整齐的样式。我们可以查看到打印的结果，并没有所有数据黏在一起，显得丑陋。
获得信息后，就是保存数据了。保存数据也很简单，<code>Python</code>的文件读写操作就可以实现。代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 文件名</span>
</span></span><span class="line"><span class="cl"><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;豆瓣图书Top250.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 保存文件操作</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 保存数据</span>
</span></span><span class="line"><span class="cl">	<span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;=======================&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;保存成功&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>运行成功，我们就可以看到项目文件下面的 txt 文件了，上面保存了我们上面打印出来的内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">书名：追风筝的人
</span></span><span class="line"><span class="cl">作者：[美] 卡勒德·胡赛尼 / 李继宏 / 上海人民出版社 / 2006-5 / 29.00元
</span></span><span class="line"><span class="cl">评分：8.8
</span></span><span class="line"><span class="cl">简介：为你，千千万万遍
</span></span><span class="line"><span class="cl">==================
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl">书名：活着
</span></span><span class="line"><span class="cl">作者：余华 / 南海出版公司 / 1998-5 / 12.00元
</span></span><span class="line"><span class="cl">评分：9.1
</span></span><span class="line"><span class="cl">简介：活着本身就是人生最大的意义
</span></span><span class="line"><span class="cl">==================
</span></span></code></pre></div><p>但是，我们要的是 250 条数据，而不是一页的十几条数据，那么要怎么获得到所有的数据呢。我们可以检查页面的信息，可以看到页面一共 10 页，第一页的URL是<code>https://book.douban.com/top250?start=0</code>。而最后一页的 URL 是<code>https://book.douban.com/top250?start=225</code>
我们接着多看几页，第二页是<code>https://book.douban.com/top250?start=25</code>，第三页是<code>https://book.douban.com/top250?start=50</code>。</p>
<p>规律已经很清晰了，我们的页面的页数信息是最后的<code>start=</code>后面的数字。而且数字从0开始到225，每一页数字加 25.这就很简单了，我们以<code>https://book.douban.com/top250?start=</code>为基层URL，每一页在后面加页面的页数数字。就可以得到所有的页面 url 了。再以<code>for</code>循环迭代每一个 url，使用上面获取数据的方法，获得所有的数据信息。</p>
<p>获取所有页面URL的代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://book.douban.com/top250?start=&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">urllist</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 从0到225，间隔25的数组</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">allurl</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">urllist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allurl</span><span class="p">)</span>
</span></span></code></pre></div><p>我们把他保存在 list 里面，好用循环迭代。</p>
<h2 id="代码">代码</h2>
<p>那么，所有的功能都实现了。现在，我们只要将所有的代码组合起来，就可以实现我们需要的所有功能了。
上代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding:utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  author: yukun</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 发出请求获得HTML源码的函数</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_html</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 伪装成浏览器访问</span>
</span></span><span class="line"><span class="cl">	<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解析页面，获得数据信息</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">html_parse</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 调用函数，for循环迭代出所有页面</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">all_page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># BeautifulSoup的解析</span>
</span></span><span class="line"><span class="cl">		<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">get_html</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># 书名</span>
</span></span><span class="line"><span class="cl">		<span class="n">alldiv</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alldiv</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># 作者</span>
</span></span><span class="line"><span class="cl">		<span class="n">allp</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;pl&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allp</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># 评分</span>
</span></span><span class="line"><span class="cl">		<span class="n">starspan</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;rating_nums&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">starspan</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># 简介</span>
</span></span><span class="line"><span class="cl">		<span class="n">sumspan</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;inq&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">sums</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sumspan</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="nb">sum</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">authors</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">sums</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">			<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;书名：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">			<span class="n">author</span> <span class="o">=</span> <span class="s1">&#39;作者：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">			<span class="n">score</span> <span class="o">=</span> <span class="s1">&#39;评分：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">			<span class="nb">sum</span> <span class="o">=</span> <span class="s1">&#39;简介：&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">			<span class="n">data</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">author</span> <span class="o">+</span> <span class="n">score</span> <span class="o">+</span> <span class="nb">sum</span>
</span></span><span class="line"><span class="cl">			<span class="c1"># 保存数据</span>
</span></span><span class="line"><span class="cl">			<span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;=======================&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获得所有页面的函数</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">all_page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://book.douban.com/top250?start=&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="n">urllist</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 从0到225，间隔25的数组</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">		<span class="n">allurl</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">urllist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allurl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span>  <span class="n">urllist</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 文件名</span>
</span></span><span class="line"><span class="cl"><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;豆瓣图书Top250.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 保存文件操作</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 调用函数</span>
</span></span><span class="line"><span class="cl"><span class="n">html_parse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;保存成功。&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></div><p>我们只用了36行的代码（去掉空行和注释）就实现了抓取豆瓣图书的数据了。大家是不是觉得很简单了，不要兴奋，这只是一个小白最基础的练手项目，大家快去找更有挑战性的项目实现吧。大家加油。</p>
<h2 id="更新">更新</h2>
<p>多谢评论区**@joker57**朋友的提醒，之前写的时候确实没有发现这个问题，由于有的书籍没有简介，导致书籍抓取不全，而且有的书名和简介不对应。实在是误导大家，下面是对没有简介书籍的处理：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 简介</span>
</span></span><span class="line"><span class="cl"><span class="n">sum_div</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;tr.item &gt; td:nth-of-type(2)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sums</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">sum_div</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sumspan</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s1">&#39;inq&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">summary</span> <span class="o">=</span> <span class="n">sumspan</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">if</span> <span class="n">sumspan</span> <span class="k">else</span> <span class="s1">&#39;无&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span></span></code></pre></div><p>为了不影响其他的代码，我们用<code>bs4</code>的 CSS 选择器选择父级元素，然后在查找简介的<code>span.inq</code>子元素，如果为<code>None</code>则给他一个“无”。</p>
<p>经过检查，成功抓取250本书籍。</p>
<p>谢谢阅读</p>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://yokonsan.github.io/tags/python/">Python</a>
                                    
                                    <a href="https://yokonsan.github.io/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                <div class="doc_comments"></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>博观约取，厚积薄发</span>
    </div>
</footer>
    <script src="https://yokonsan.github.io/js/jquery-3.5.1.min.js"></script>
<link href="https://yokonsan.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://yokonsan.github.io/js/fancybox.min.js"></script>
<script src="https://yokonsan.github.io/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



</body>

</html>